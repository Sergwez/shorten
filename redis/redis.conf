# Redis конфигурация для кеширования URL и очередей
# DB 0: кеш URL, DB 1: очереди Bull
# Оптимизирована для высокой производительности чтения

# ======================
# СЕТЕВЫЕ НАСТРОЙКИ
# ======================
bind 0.0.0.0
port 6379
tcp-keepalive 300
timeout 0
tcp-backlog 511

# ======================
# ПАМЯТЬ И КЕШИРОВАНИЕ
# ======================
# Максимальный объем памяти для кеша
maxmemory 256mb

# Политика вытеснения: удаляем наименее используемые ключи
maxmemory-policy allkeys-lru

# Образцы для LRU (больше = точнее, но медленнее)
maxmemory-samples 5

# ======================
# ПЕРСИСТЕНТНОСТЬ 
# ======================
# Отключаем RDB снэпшоты для кеша (данные не критичны)
save ""

# Отключаем AOF для максимальной скорости
appendonly no

# ======================
# ЛОГИРОВАНИЕ
# ======================
loglevel notice
logfile ""
syslog-enabled no

# ======================
# КЛИЕНТЫ
# ======================
maxclients 10000

# ======================
# ОПТИМИЗАЦИЯ ПРОИЗВОДИТЕЛЬНОСТИ
# ======================
# Ленивое освобождение памяти
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes

# Отключаем медленные операции
rdbcompression no
rdbchecksum no

# Настройки хеш-таблиц для производительности
hash-max-ziplist-entries 512
hash-max-ziplist-value 64

# ======================
# БЕЗОПАСНОСТЬ
# ======================
# Отключаем опасные команды в продакшене
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command SHUTDOWN SHUTDOWN_CACHE_REDIS

# ======================
# МОНИТОРИНГ
# ======================
# Включаем статистику
latency-monitor-threshold 100 